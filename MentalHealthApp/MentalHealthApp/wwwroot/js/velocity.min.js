function IconSelect(n,t){function s(){if(t||(t={}),i.setIconSelectElement(n)){t=o.checkParameters(t);var r=i.createUI(t,n);i.iconSelectElement.onclick=function(){i.showBox()};i.showBox(!1);i.iconSelectElement.addEventListener("click",function(n){n.stopPropagation()});window.addEventListener("click",function(){i.showBox(!1)})}else alert("Element not found.")}function i(){}function o(){}var r=[],f=-1,e,u=IconSelect.DEFAULT;this.refresh=function(n){var e,u,f;for(r=[],e=this.setSelectedIndex,u=0;u<n.length;u++)n[u].element=i.createIcon(n[u].iconFilePath,n[u].iconValue,u,t),n[u].element.onclick=function(){e(this.childNodes[0].getAttribute("icon-index"));try{document.getElementById("Avatar").setAttribute("value",this.childNodes[0].getAttribute("icon-value"))}catch(n){}},r.push(n[u]);f=Math.round(n.length/t.vectoralIconNumber);i.boxElement.style.height=(t.iconsHeight+2)*f+(f+1)*t.boxIconSpace;this.setSelectedIndex(0)};this.getIcons=function(){return r};this.setSelectedIndex=function(n){var t;r.length>n&&(t=r[n]);t&&(f!=-1&&r[f].element.setAttribute("class","icon"),f=n,i.selectedIconImgElement.setAttribute("src",t.iconFilePath),f!=-1&&r[f].element.setAttribute("class","icon selected"));i.iconSelectElement.dispatchEvent(new Event("changed"))};this.getSelectedIndex=function(){return f};this.getSelectedValue=function(){return r[f].iconValue};this.getSelectedFilePath=function(){return r[f].iconFilePath};i.iconSelectElement;i.boxElement;i.boxScrollElement;i.selectedIconImgElement;i.selectedIconElement;i.showBox=function(t){t==null&&(t=i.boxElement.style.display=="none"?!0:!1);t?(i.boxElement.style.display="block",i.boxScrollElement.style.display="block",e=e?e:new iScroll(n+"-box-scroll")):(i.boxElement.style.display="none",i.boxScrollElement.style.display="none");i.boxElement.style.display=t?"block":"none"};i.setIconSelectElement=function(n){return i.iconSelectElement=document.getElementById(n),i.iconSelectElement};i.clearUI=function(){i.iconSelectElement.innerHTML=""};i.clearIcons=function(){i.boxElement.innerHTML=""};i.createUI=function(t){var r,u,e,o,f;return i.clearUI(),i.iconSelectElement.setAttribute("class","icon-select"),r=document.createElement("div"),r.setAttribute("class","selected-box"),u=document.createElement("div"),u.setAttribute("class","selected-icon"),i.selectedIconImgElement=document.createElement("img"),i.selectedIconImgElement.setAttribute("src",""),u.appendChild(i.selectedIconImgElement),e=document.createElement("div"),e.setAttribute("class","component-icon"),o=document.createElement("img"),o.setAttribute("src",IconSelect.COMPONENT_ICON_FILE_PATH),e.appendChild(o),i.boxScrollElement=document.createElement("div"),i.boxScrollElement.setAttribute("id",n+"-box-scroll"),i.boxScrollElement.setAttribute("class","box"),i.boxElement=document.createElement("div"),i.boxScrollElement.appendChild(i.boxElement),i.selectedIconImgElement.setAttribute("width",t.selectedIconWidth),i.selectedIconImgElement.setAttribute("height",t.selectedIconHeight),u.style.width=t.selectedIconWidth,u.style.height=t.selectedIconHeight,r.style.width=t.selectedIconWidth+t.selectedBoxPadding+t.selectedBoxPaddingRight,r.style.height=t.selectedIconHeight+t.selectedBoxPadding*2,u.style.top=t.selectedBoxPadding,u.style.left=t.selectedBoxPadding,e.style.bottom=4+t.selectedBoxPadding,i.boxScrollElement.style.left=parseInt(r.style.width)+1,i.boxScrollElement.style.width=(t.iconsWidth+2)*t.vectoralIconNumber+(t.vectoralIconNumber+1)*t.boxIconSpace,i.boxScrollElement.style.height=(t.iconsHeight+2)*t.horizontalIconNumber+(t.horizontalIconNumber+1)*t.boxIconSpace,i.boxElement.style.left=i.boxScrollElement.style.left,i.boxElement.style.width=i.boxScrollElement.style.width,i.iconSelectElement.appendChild(r),r.appendChild(u),r.appendChild(e),r.appendChild(i.boxScrollElement),f={},f.iconSelectElement=i.iconSelectElement,f.selectedBoxElement=r,f.selectedIconElement=u,f.selectedIconImgElement=i.selectedIconImgElement,f.componentIconElement=e,f.componentIconImgElement=o,f};i.createIcon=function(n,t,r,u){var f=document.createElement("div"),e;return f.setAttribute("class","icon"),f.setAttribute("onClick","updateAvatar('"+t+"')"),f.style.width=u.iconsWidth,f.style.height=u.iconsHeight,f.style.marginLeft=u.boxIconSpace,f.style.marginTop=u.boxIconSpace,e=document.createElement("img"),e.setAttribute("src",n),e.setAttribute("icon-value",t),e.setAttribute("icon-index",r),e.setAttribute("width",u.iconsWidth),e.setAttribute("height",u.iconsHeight),f.appendChild(e),i.boxElement.appendChild(f),f};o.checkParameters=function(n){return n.selectedIconWidth=n.selectedIconWidth?n.selectedIconWidth:u.SELECTED_ICON_WIDTH,n.selectedIconHeight=n.selectedIconHeight?n.selectedIconHeight:u.SELECTED_ICON_HEIGHT,n.selectedBoxPadding=n.selectedBoxPadding?n.selectedBoxPadding:u.SELECTED_BOX_PADDING,n.selectedBoxPaddingRight=n.selectedBoxPaddingRight?n.selectedBoxPaddingRight:u.SELECTED_BOX_PADDING_RIGHT,n.iconsWidth=n.iconsWidth?n.iconsWidth:u.ICONS_WIDTH,n.iconsHeight=n.iconsHeight?n.iconsHeight:u.ICONS_HEIGHT,n.boxIconSpace=n.boxIconSpace?n.boxIconSpace:u.BOX_ICON_SPACE,n.vectoralIconNumber=n.vectoralIconNumber?n.vectoralIconNumber:u.VECTORAL_ICON_NUMBER,n.horizontalIconNumber=n.horizontalIconNumber?n.horizontalIconNumber:u.HORIZONTAL_ICON_NUMBER,n};s()}IconSelect.DEFAULT={};IconSelect.DEFAULT.SELECTED_ICON_WIDTH=48;IconSelect.DEFAULT.SELECTED_ICON_HEIGHT=48;IconSelect.DEFAULT.SELECTED_BOX_PADDING=1;IconSelect.DEFAULT.SELECTED_BOX_PADDING_RIGHT=12;IconSelect.DEFAULT.ICONS_WIDTH=32;IconSelect.DEFAULT.ICONS_HEIGHT=32;IconSelect.DEFAULT.BOX_ICON_SPACE=1;IconSelect.DEFAULT.HORIZONTAL_ICON_NUMBER=3;IconSelect.DEFAULT.VECTORAL_ICON_NUMBER=3;IconSelect.COMPONENT_ICON_FILE_PATH="/images/arrow.png";
/*!
 * iScroll v4.2.5 ~ Copyright (c) 2012 Matteo Spinelli, http://cubiq.org
 * Released under MIT license, http://cubiq.org/license
 */
(function(n,t){function s(n){return f===""?n:(n=n.charAt(0).toUpperCase()+n.substr(1),f+n)}var i=Math,y=t.createElement("div").style,f=function(){for(var t="t,webkitT,MozT,msT,OT".split(","),i,n=0,r=t.length;n<r;n++)if(i=t[n]+"ransform",i in y)return t[n].substr(0,t[n].length-1);return!1}(),u=f?"-"+f.toLowerCase()+"-":"",e=s("transform"),rt=s("transitionProperty"),h=s("transitionDuration"),ut=s("transformOrigin"),ft=s("transitionTimingFunction"),p=s("transitionDelay"),w=/android/gi.test(navigator.appVersion),g=/iphone|ipad/gi.test(navigator.appVersion),et=/hp-tablet/gi.test(navigator.appVersion),nt=s("perspective")in y,r="ontouchstart"in n&&!et,tt=f!==!1,ot=s("transition")in y,b="onorientationchange"in n?"orientationchange":"resize",k=r?"touchstart":"mousedown",l=r?"touchmove":"mousemove",a=r?"touchend":"mouseup",v=r?"touchcancel":"mouseup",c=function(){if(f===!1)return!1;return{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[f]}(),st=function(){return n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(n){return setTimeout(n,1)}}(),it=function(){return n.cancelRequestAnimationFrame||n.webkitCancelAnimationFrame||n.webkitCancelRequestAnimationFrame||n.mozCancelRequestAnimationFrame||n.oCancelRequestAnimationFrame||n.msCancelRequestAnimationFrame||clearTimeout}(),o=nt?" translateZ(0)":"",d=function(i,f){var s=this,c;s.wrapper=typeof i=="object"?i:t.getElementById(i);s.wrapper.style.overflow="hidden";s.scroller=s.wrapper.children[0];s.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:w,hideScrollbar:g,fadeScrollbar:g&&nt,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(n){n.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(c in f)s.options[c]=f[c];s.x=s.options.x;s.y=s.options.y;s.options.useTransform=tt&&s.options.useTransform;s.options.hScrollbar=s.options.hScroll&&s.options.hScrollbar;s.options.vScrollbar=s.options.vScroll&&s.options.vScrollbar;s.options.zoom=s.options.useTransform&&s.options.zoom;s.options.useTransition=ot&&s.options.useTransition;s.options.zoom&&w&&(o="");s.scroller.style[rt]=s.options.useTransform?u+"transform":"top left";s.scroller.style[h]="0";s.scroller.style[ut]="0 0";s.options.useTransition&&(s.scroller.style[ft]="cubic-bezier(0.33,0.66,0.66,1)");s.options.useTransform?s.scroller.style[e]="translate("+s.x+"px,"+s.y+"px)"+o:s.scroller.style.cssText+=";position:absolute;top:"+s.y+"px;left:"+s.x+"px";s.options.useTransition&&(s.options.fixedScrollbar=!0);s.refresh();s._bind(b,n);s._bind(k);r||s.options.wheelAction!="none"&&(s._bind("DOMMouseScroll"),s._bind("mousewheel"));s.options.checkDOMChanges&&(s.checkDOMTime=setInterval(function(){s._checkDOMChanges()},500))};d.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(n){var t=this;switch(n.type){case k:if(!r&&n.button!==0)return;t._start(n);break;case l:t._move(n);break;case a:case v:t._end(n);break;case b:t._resize();break;case"DOMMouseScroll":case"mousewheel":t._wheel(n);break;case c:t._transitionEnd(n)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(n){var r=this,f;if(!r[n+"Scrollbar"]){r[n+"ScrollbarWrapper"]&&(tt&&(r[n+"ScrollbarIndicator"].style[e]=""),r[n+"ScrollbarWrapper"].parentNode.removeChild(r[n+"ScrollbarWrapper"]),r[n+"ScrollbarWrapper"]=null,r[n+"ScrollbarIndicator"]=null);return}r[n+"ScrollbarWrapper"]||(f=t.createElement("div"),r.options.scrollbarClass?f.className=r.options.scrollbarClass+n.toUpperCase():f.style.cssText="position:absolute;z-index:100;"+(n=="h"?"height:7px;bottom:1px;left:2px;right:"+(r.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(r.hScrollbar?"7":"2")+"px;top:2px;right:1px"),f.style.cssText+=";pointer-events:none;"+u+"transition-property:opacity;"+u+"transition-duration:"+(r.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(r.options.hideScrollbar?"0":"1"),r.wrapper.appendChild(f),r[n+"ScrollbarWrapper"]=f,f=t.createElement("div"),r.options.scrollbarClass||(f.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+u+"background-clip:padding-box;"+u+"box-sizing:border-box;"+(n=="h"?"height:100%":"width:100%")+";"+u+"border-radius:3px;border-radius:3px"),f.style.cssText+=";pointer-events:none;"+u+"transition-property:"+u+"transform;"+u+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+u+"transition-duration:0;"+u+"transform: translate(0,0)"+o,r.options.useTransition&&(f.style.cssText+=";"+u+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),r[n+"ScrollbarWrapper"].appendChild(f),r[n+"ScrollbarIndicator"]=f);n=="h"?(r.hScrollbarSize=r.hScrollbarWrapper.clientWidth,r.hScrollbarIndicatorSize=i.max(i.round(r.hScrollbarSize*r.hScrollbarSize/r.scrollerW),8),r.hScrollbarIndicator.style.width=r.hScrollbarIndicatorSize+"px",r.hScrollbarMaxScroll=r.hScrollbarSize-r.hScrollbarIndicatorSize,r.hScrollbarProp=r.hScrollbarMaxScroll/r.maxScrollX):(r.vScrollbarSize=r.vScrollbarWrapper.clientHeight,r.vScrollbarIndicatorSize=i.max(i.round(r.vScrollbarSize*r.vScrollbarSize/r.scrollerH),8),r.vScrollbarIndicator.style.height=r.vScrollbarIndicatorSize+"px",r.vScrollbarMaxScroll=r.vScrollbarSize-r.vScrollbarIndicatorSize,r.vScrollbarProp=r.vScrollbarMaxScroll/r.maxScrollY);r._scrollbarPos(n,!0)},_resize:function(){var n=this;setTimeout(function(){n.refresh()},w?200:0)},_pos:function(n,t){this.zoomed||(n=this.hScroll?n:0,t=this.vScroll?t:0,this.options.useTransform?this.scroller.style[e]="translate("+n+"px,"+t+"px) scale("+this.scale+")"+o:(n=i.round(n),t=i.round(t),this.scroller.style.left=n+"px",this.scroller.style.top=t+"px"),this.x=n,this.y=t,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(n,t){var r=this,u=n=="h"?r.x:r.y,f;r[n+"Scrollbar"]&&(u=r[n+"ScrollbarProp"]*u,u<0?(r.options.fixedScrollbar||(f=r[n+"ScrollbarIndicatorSize"]+i.round(u*3),f<8&&(f=8),r[n+"ScrollbarIndicator"].style[n=="h"?"width":"height"]=f+"px"),u=0):u>r[n+"ScrollbarMaxScroll"]&&(r.options.fixedScrollbar?u=r[n+"ScrollbarMaxScroll"]:(f=r[n+"ScrollbarIndicatorSize"]-i.round((u-r[n+"ScrollbarMaxScroll"])*3),f<8&&(f=8),r[n+"ScrollbarIndicator"].style[n=="h"?"width":"height"]=f+"px",u=r[n+"ScrollbarMaxScroll"]+(r[n+"ScrollbarIndicatorSize"]-f))),r[n+"ScrollbarWrapper"].style[p]="0",r[n+"ScrollbarWrapper"].style.opacity=t&&r.options.hideScrollbar?"0":"1",r[n+"ScrollbarIndicator"].style[e]="translate("+(n=="h"?u+"px,0)":"0,"+u+"px)")+o)},_start:function(t){var u=this,p=r?t.touches[0]:t,f,o,s,h,y;u.enabled&&(u.options.onBeforeScrollStart&&u.options.onBeforeScrollStart.call(u,t),(u.options.useTransition||u.options.zoom)&&u._transitionTime(0),u.moved=!1,u.animating=!1,u.zoomed=!1,u.distX=0,u.distY=0,u.absDistX=0,u.absDistY=0,u.dirX=0,u.dirY=0,u.options.zoom&&r&&t.touches.length>1&&(h=i.abs(t.touches[0].pageX-t.touches[1].pageX),y=i.abs(t.touches[0].pageY-t.touches[1].pageY),u.touchesDistStart=i.sqrt(h*h+y*y),u.originX=i.abs(t.touches[0].pageX+t.touches[1].pageX-u.wrapperOffsetLeft*2)/2-u.x,u.originY=i.abs(t.touches[0].pageY+t.touches[1].pageY-u.wrapperOffsetTop*2)/2-u.y,u.options.onZoomStart&&u.options.onZoomStart.call(u,t)),u.options.momentum&&(u.options.useTransform?(f=getComputedStyle(u.scroller,null)[e].replace(/[^0-9\-.,]/g,"").split(","),o=+(f[12]||f[4]),s=+(f[13]||f[5])):(o=+getComputedStyle(u.scroller,null).left.replace(/[^0-9-]/g,""),s=+getComputedStyle(u.scroller,null).top.replace(/[^0-9-]/g,"")),(o!=u.x||s!=u.y)&&(u.options.useTransition?u._unbind(c):it(u.aniTime),u.steps=[],u._pos(o,s),u.options.onScrollEnd&&u.options.onScrollEnd.call(u))),u.absStartX=u.x,u.absStartY=u.y,u.startX=u.x,u.startY=u.y,u.pointX=p.pageX,u.pointY=p.pageY,u.startTime=t.timeStamp||Date.now(),u.options.onScrollStart&&u.options.onScrollStart.call(u,t),u._bind(l,n),u._bind(a,n),u._bind(v,n))},_move:function(n){var t=this,l=r?n.touches[0]:n,h=l.pageX-t.pointX,c=l.pageY-t.pointY,f=t.x+h,s=t.y+c,a,v,u,y=n.timeStamp||Date.now();if(t.options.onBeforeScrollMove&&t.options.onBeforeScrollMove.call(t,n),t.options.zoom&&r&&n.touches.length>1){a=i.abs(n.touches[0].pageX-n.touches[1].pageX);v=i.abs(n.touches[0].pageY-n.touches[1].pageY);t.touchesDist=i.sqrt(a*a+v*v);t.zoomed=!0;u=1/t.touchesDistStart*t.touchesDist*this.scale;u<t.options.zoomMin?u=.5*t.options.zoomMin*Math.pow(2,u/t.options.zoomMin):u>t.options.zoomMax&&(u=2*t.options.zoomMax*Math.pow(.5,t.options.zoomMax/u));t.lastScale=u/this.scale;f=this.originX-this.originX*t.lastScale+this.x;s=this.originY-this.originY*t.lastScale+this.y;this.scroller.style[e]="translate("+f+"px,"+s+"px) scale("+u+")"+o;t.options.onZoom&&t.options.onZoom.call(t,n);return}(t.pointX=l.pageX,t.pointY=l.pageY,(f>0||f<t.maxScrollX)&&(f=t.options.bounce?t.x+h/2:f>=0||t.maxScrollX>=0?0:t.maxScrollX),(s>t.minScrollY||s<t.maxScrollY)&&(s=t.options.bounce?t.y+c/2:s>=t.minScrollY||t.maxScrollY>=0?t.minScrollY:t.maxScrollY),t.distX+=h,t.distY+=c,t.absDistX=i.abs(t.distX),t.absDistY=i.abs(t.distY),t.absDistX<6&&t.absDistY<6)||(t.options.lockDirection&&(t.absDistX>t.absDistY+5?(s=t.y,c=0):t.absDistY>t.absDistX+5&&(f=t.x,h=0)),t.moved=!0,t._pos(f,s),t.dirX=h>0?-1:h<0?1:0,t.dirY=c>0?-1:c<0?1:0,y-t.startTime>300&&(t.startTime=y,t.startX=t.x,t.startY=t.y),t.options.onScrollMove&&t.options.onScrollMove.call(t,n))},_end:function(u){if(!r||u.touches.length===0){var f=this,d=r?u.changedTouches[0]:u,p,g,b={dist:0,time:0},k={dist:0,time:0},rt=(u.timeStamp||Date.now())-f.startTime,s=f.x,c=f.y,nt,tt,it,y,w;if(f._unbind(l,n),f._unbind(a,n),f._unbind(v,n),f.options.onBeforeScrollEnd&&f.options.onBeforeScrollEnd.call(f,u),f.zoomed){w=f.scale*f.lastScale;w=Math.max(f.options.zoomMin,w);w=Math.min(f.options.zoomMax,w);f.lastScale=w/f.scale;f.scale=w;f.x=f.originX-f.originX*f.lastScale+f.x;f.y=f.originY-f.originY*f.lastScale+f.y;f.scroller.style[h]="200ms";f.scroller.style[e]="translate("+f.x+"px,"+f.y+"px) scale("+f.scale+")"+o;f.zoomed=!1;f.refresh();f.options.onZoomEnd&&f.options.onZoomEnd.call(f,u);return}if(!f.moved){r&&(f.doubleTapTimer&&f.options.zoom?(clearTimeout(f.doubleTapTimer),f.doubleTapTimer=null,f.options.onZoomStart&&f.options.onZoomStart.call(f,u),f.zoom(f.pointX,f.pointY,f.scale==1?f.options.doubleTapZoom:1),f.options.onZoomEnd&&setTimeout(function(){f.options.onZoomEnd.call(f,u)},200)):this.options.handleClick&&(f.doubleTapTimer=setTimeout(function(){for(f.doubleTapTimer=null,p=d.target;p.nodeType!=1;)p=p.parentNode;p.tagName!="SELECT"&&p.tagName!="INPUT"&&p.tagName!="TEXTAREA"&&(g=t.createEvent("MouseEvents"),g.initMouseEvent("click",!0,!0,u.view,1,d.screenX,d.screenY,d.clientX,d.clientY,u.ctrlKey,u.altKey,u.shiftKey,u.metaKey,0,null),g._fake=!0,p.dispatchEvent(g))},f.options.zoom?250:0)));f._resetPos(400);f.options.onTouchEnd&&f.options.onTouchEnd.call(f,u);return}if(rt<300&&f.options.momentum&&(b=s?f._momentum(s-f.startX,rt,-f.x,f.scrollerW-f.wrapperW+f.x,f.options.bounce?f.wrapperW:0):b,k=c?f._momentum(c-f.startY,rt,-f.y,f.maxScrollY<0?f.scrollerH-f.wrapperH+f.y-f.minScrollY:0,f.options.bounce?f.wrapperH:0):k,s=f.x+b.dist,c=f.y+k.dist,(f.x>0&&s>0||f.x<f.maxScrollX&&s<f.maxScrollX)&&(b={dist:0,time:0}),(f.y>f.minScrollY&&c>f.minScrollY||f.y<f.maxScrollY&&c<f.maxScrollY)&&(k={dist:0,time:0})),b.dist||k.dist){it=i.max(i.max(b.time,k.time),10);f.options.snap&&(nt=s-f.absStartX,tt=c-f.absStartY,i.abs(nt)<f.options.snapThreshold&&i.abs(tt)<f.options.snapThreshold?f.scrollTo(f.absStartX,f.absStartY,200):(y=f._snap(s,c),s=y.x,c=y.y,it=i.max(y.time,it)));f.scrollTo(i.round(s),i.round(c),it);f.options.onTouchEnd&&f.options.onTouchEnd.call(f,u);return}if(f.options.snap){nt=s-f.absStartX;tt=c-f.absStartY;i.abs(nt)<f.options.snapThreshold&&i.abs(tt)<f.options.snapThreshold?f.scrollTo(f.absStartX,f.absStartY,200):(y=f._snap(f.x,f.y),(y.x!=f.x||y.y!=f.y)&&f.scrollTo(y.x,y.y,y.time));f.options.onTouchEnd&&f.options.onTouchEnd.call(f,u);return}f._resetPos(200);f.options.onTouchEnd&&f.options.onTouchEnd.call(f,u)}},_resetPos:function(n){var t=this,i=t.x>=0?0:t.x<t.maxScrollX?t.maxScrollX:t.x,r=t.y>=t.minScrollY||t.maxScrollY>0?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(i==t.x&&r==t.y){t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t));t.hScrollbar&&t.options.hideScrollbar&&(f=="webkit"&&(t.hScrollbarWrapper.style[p]="300ms"),t.hScrollbarWrapper.style.opacity="0");t.vScrollbar&&t.options.hideScrollbar&&(f=="webkit"&&(t.vScrollbarWrapper.style[p]="300ms"),t.vScrollbarWrapper.style.opacity="0");return}t.scrollTo(i,r,n||0)},_wheel:function(n){var t=this,e,i,u,f,r;if("wheelDeltaX"in n)e=n.wheelDeltaX/12,i=n.wheelDeltaY/12;else if("wheelDelta"in n)e=i=n.wheelDelta/12;else if("detail"in n)e=i=-n.detail*3;else return;if(t.options.wheelAction=="zoom"){r=t.scale*Math.pow(2,1/3*(i?i/Math.abs(i):0));r<t.options.zoomMin&&(r=t.options.zoomMin);r>t.options.zoomMax&&(r=t.options.zoomMax);r!=t.scale&&(!t.wheelZoomCount&&t.options.onZoomStart&&t.options.onZoomStart.call(t,n),t.wheelZoomCount++,t.zoom(n.pageX,n.pageY,r,400),setTimeout(function(){t.wheelZoomCount--;!t.wheelZoomCount&&t.options.onZoomEnd&&t.options.onZoomEnd.call(t,n)},400));return}u=t.x+e;f=t.y+i;u>0?u=0:u<t.maxScrollX&&(u=t.maxScrollX);f>t.minScrollY?f=t.minScrollY:f<t.maxScrollY&&(f=t.maxScrollY);t.maxScrollY<0&&t.scrollTo(u,f,0)},_transitionEnd:function(n){var t=this;n.target==t.scroller&&(t._unbind(c),t._startAni())},_startAni:function(){var n=this,r=n.x,u=n.y,o=Date.now(),t,f,e;if(!n.animating){if(!n.steps.length){n._resetPos(400);return}if(t=n.steps.shift(),t.x==r&&t.y==u&&(t.time=0),n.animating=!0,n.moved=!0,n.options.useTransition){n._transitionTime(t.time);n._pos(t.x,t.y);n.animating=!1;t.time?n._bind(c):n._resetPos(0);return}e=function(){var s=Date.now(),h,c;if(s>=o+t.time){n._pos(t.x,t.y);n.animating=!1;n.options.onAnimationEnd&&n.options.onAnimationEnd.call(n);n._startAni();return}s=(s-o)/t.time-1;f=i.sqrt(1-s*s);h=(t.x-r)*f+r;c=(t.y-u)*f+u;n._pos(h,c);n.animating&&(n.aniTime=st(e))};e()}},_transitionTime:function(n){n+="ms";this.scroller.style[h]=n;this.hScrollbar&&(this.hScrollbarIndicator.style[h]=n);this.vScrollbar&&(this.vScrollbarIndicator.style[h]=n)},_momentum:function(n,t,r,u,f){var s=.0006,o=i.abs(n)/t,e=o*o/(2*s),c=0,h=0;return n>0&&e>r?(h=f/(6/(e/o*s)),r=r+h,o=o*r/e,e=r):n<0&&e>u&&(h=f/(6/(e/o*s)),u=u+h,o=o*u/e,e=u),e=e*(n<0?-1:1),c=o/s,{dist:e,time:i.round(c)}},_offset:function(n){for(var t=-n.offsetLeft,i=-n.offsetTop;n=n.offsetParent;)t-=n.offsetLeft,i-=n.offsetTop;return n!=this.wrapper&&(t*=this.scale,i*=this.scale),{left:t,top:i}},_snap:function(n,t){var r=this,f,s,u,h,e,o;for(u=r.pagesX.length-1,f=0,s=r.pagesX.length;f<s;f++)if(n>=r.pagesX[f]){u=f;break}for(u==r.currPageX&&u>0&&r.dirX<0&&u--,n=r.pagesX[u],e=i.abs(n-r.pagesX[r.currPageX]),e=e?i.abs(r.x-n)/e*500:0,r.currPageX=u,u=r.pagesY.length-1,f=0;f<u;f++)if(t>=r.pagesY[f]){u=f;break}return u==r.currPageY&&u>0&&r.dirY<0&&u--,t=r.pagesY[u],o=i.abs(t-r.pagesY[r.currPageY]),o=o?i.abs(r.y-t)/o*500:0,r.currPageY=u,h=i.round(i.max(e,o))||200,{x:n,y:t,time:h}},_bind:function(n,t,i){(t||this.scroller).addEventListener(n,this,!!i)},_unbind:function(n,t,i){(t||this.scroller).removeEventListener(n,this,!!i)},destroy:function(){var t=this;t.scroller.style[e]="";t.hScrollbar=!1;t.vScrollbar=!1;t._scrollbar("h");t._scrollbar("v");t._unbind(b,n);t._unbind(k);t._unbind(l,n);t._unbind(a,n);t._unbind(v,n);t.options.hasTouch||(t._unbind("DOMMouseScroll"),t._unbind("mousewheel"));t.options.useTransition&&t._unbind(c);t.options.checkDOMChanges&&clearInterval(t.checkDOMTime);t.options.onDestroy&&t.options.onDestroy.call(t)},refresh:function(){var n=this,f,r,o,e,t=0,u=0;if(n.scale<n.options.zoomMin&&(n.scale=n.options.zoomMin),n.wrapperW=n.wrapper.clientWidth||1,n.wrapperH=n.wrapper.clientHeight||1,n.minScrollY=-n.options.topOffset||0,n.scrollerW=i.round(n.scroller.offsetWidth*n.scale),n.scrollerH=i.round((n.scroller.offsetHeight+n.minScrollY)*n.scale),n.maxScrollX=n.wrapperW-n.scrollerW,n.maxScrollY=n.wrapperH-n.scrollerH+n.minScrollY,n.dirX=0,n.dirY=0,n.options.onRefresh&&n.options.onRefresh.call(n),n.hScroll=n.options.hScroll&&n.maxScrollX<0,n.vScroll=n.options.vScroll&&(!n.options.bounceLock&&!n.hScroll||n.scrollerH>n.wrapperH),n.hScrollbar=n.hScroll&&n.options.hScrollbar,n.vScrollbar=n.vScroll&&n.options.vScrollbar&&n.scrollerH>n.wrapperH,f=n._offset(n.wrapper),n.wrapperOffsetLeft=-f.left,n.wrapperOffsetTop=-f.top,typeof n.options.snap=="string")for(n.pagesX=[],n.pagesY=[],e=n.scroller.querySelectorAll(n.options.snap),r=0,o=e.length;r<o;r++)t=n._offset(e[r]),t.left+=n.wrapperOffsetLeft,t.top+=n.wrapperOffsetTop,n.pagesX[r]=t.left<n.maxScrollX?n.maxScrollX:t.left*n.scale,n.pagesY[r]=t.top<n.maxScrollY?n.maxScrollY:t.top*n.scale;else if(n.options.snap){for(n.pagesX=[];t>=n.maxScrollX;)n.pagesX[u]=t,t=t-n.wrapperW,u++;for(n.maxScrollX%n.wrapperW&&(n.pagesX[n.pagesX.length]=n.maxScrollX-n.pagesX[n.pagesX.length-1]+n.pagesX[n.pagesX.length-1]),t=0,u=0,n.pagesY=[];t>=n.maxScrollY;)n.pagesY[u]=t,t=t-n.wrapperH,u++;n.maxScrollY%n.wrapperH&&(n.pagesY[n.pagesY.length]=n.maxScrollY-n.pagesY[n.pagesY.length-1]+n.pagesY[n.pagesY.length-1])}n._scrollbar("h");n._scrollbar("v");n.zoomed||(n.scroller.style[h]="0",n._resetPos(400))},scrollTo:function(n,t,i,r){var e=this,u=n,f,o;for(e.stop(),u.length||(u=[{x:n,y:t,time:i,relative:r}]),f=0,o=u.length;f<o;f++)u[f].relative&&(u[f].x=e.x-u[f].x,u[f].y=e.y-u[f].y),e.steps.push({x:u[f].x,y:u[f].y,time:u[f].time||0});e._startAni()},scrollToElement:function(n,t){var u=this,r;(n=n.nodeType?n:u.scroller.querySelector(n),n)&&(r=u._offset(n),r.left+=u.wrapperOffsetLeft,r.top+=u.wrapperOffsetTop,r.left=r.left>0?0:r.left<u.maxScrollX?u.maxScrollX:r.left,r.top=r.top>u.minScrollY?u.minScrollY:r.top<u.maxScrollY?u.maxScrollY:r.top,t=t===undefined?i.max(i.abs(r.left)*2,i.abs(r.top)*2):t,u.scrollTo(r.left,r.top,t))},scrollToPage:function(n,t,i){var r=this,u,f;i=i===undefined?400:i;r.options.onScrollStart&&r.options.onScrollStart.call(r);r.options.snap?(n=n=="next"?r.currPageX+1:n=="prev"?r.currPageX-1:n,t=t=="next"?r.currPageY+1:t=="prev"?r.currPageY-1:t,n=n<0?0:n>r.pagesX.length-1?r.pagesX.length-1:n,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=n,r.currPageY=t,u=r.pagesX[n],f=r.pagesY[t]):(u=-r.wrapperW*n,f=-r.wrapperH*t,u<r.maxScrollX&&(u=r.maxScrollX),f<r.maxScrollY&&(f=r.maxScrollY));r.scrollTo(u,f,i)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(l,n);this._unbind(a,n);this._unbind(v,n)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(c):it(this.aniTime);this.steps=[];this.moved=!1;this.animating=!1},zoom:function(n,t,i,r){var u=this,f=i/u.scale;u.options.useTransform&&(u.zoomed=!0,r=r===undefined?200:r,n=n-u.wrapperOffsetLeft-u.x,t=t-u.wrapperOffsetTop-u.y,u.x=n-n*f+u.x,u.y=t-t*f+u.y,u.scale=i,u.refresh(),u.x=u.x>0?0:u.x<u.maxScrollX?u.maxScrollX:u.x,u.y=u.y>u.minScrollY?u.minScrollY:u.y<u.maxScrollY?u.maxScrollY:u.y,u.scroller.style[h]=r+"ms",u.scroller.style[e]="translate("+u.x+"px,"+u.y+"px) scale("+i+")"+o,u.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};y=null;typeof exports!="undefined"?exports.iScroll=d:n.iScroll=d})(window,document);